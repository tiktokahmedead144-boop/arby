<!doctype html>
<html lang="ar" dir="rtl"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Ù…Ù†ØµØ© Ù„ØºØªÙŠ Ù‡ÙˆÙŠØªÙŠ</title> 
  <base href="./">
  <base href="./">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script>
    // Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙŠÙ…Ù†Ø¹ Ø¸Ù‡ÙˆØ± ØµÙØ­Ø© Ø§Ù„Ø®Ø·Ø£ Ø¥Ø°Ø§ ØªØ£Ø®Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
    if (window.location.protocol === 'file:') {
        window.alert = function(msg) { console.log(msg); };
    }
    // Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    window.history.pushState(null, null, window.location.href);
</script>


<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&amp;display=swap" rel="stylesheet"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"> 
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
  <style>
        :root { 
            --main: #4a90e2; --sec: #2ecc71; --vocab: #9b59b6; 
            --video: #e67e22; --err: #e74c3c; --bg: #f4f7f6; 
            --white: #ffffff; --text: #2d3436; 
        }

        * { box-sizing: border-box; transition: 0.3s; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 0; min-height: 100vh; }

        .swal2-popup { border-radius: 25px !important; font-family: 'Cairo', sans-serif !important; }
        .swal2-styled.swal2-confirm { background-color: var(--main) !important; border-radius: 12px !important; }

        #update-banner {
            display: none; background: #e74c3c; color: white; 
            text-align: center; padding: 12px; font-weight: bold; 
            position: sticky; top: 0; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #update-banner a { color: #fff; background: rgba(0,0,0,0.2); padding: 4px 10px; border-radius: 8px; text-decoration: none; margin-right: 10px; border: 1px solid white; }

        .container { 
            width: 100%; max-width: 950px; background: var(--white); 
            border-radius: 30px; padding: 25px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.05); margin: 10px auto; 
        }

        .header-brand { text-align: center; margin-bottom: 20px; }
        .header-brand img { width: 90px; margin-bottom: 10px; }
        .header-brand h1 { font-size: 2.2rem; margin: 0; color: var(--main); font-weight: 900; }
        
        .social-bar { 
            display: flex; justify-content: center; gap: 15px; 
            margin: 20px 0; border-bottom: 1px solid #eee; padding-bottom: 20px; 
        }
        .social-bar a { font-size: 24px; text-decoration: none; color: var(--text); display: none; }

        .btn { 
            width: 100%; padding: 15px; border-radius: 15px; border: none; 
            font-weight: 700; cursor: pointer; display: flex; 
            align-items: center; justify-content: center; gap: 10px; 
            margin-bottom: 12px; font-size: 16px; color: white;
        }
        .btn-main { background: linear-gradient(135deg, #4a90e2, #2563eb); }
        .btn-sec { background: linear-gradient(135deg, #2ecc71, #219150); }
        .btn-video { background: linear-gradient(135deg, #e67e22, #c2410c); }
        .btn-outline { background: #fff; border: 2px solid #e2e8f0; color: #64748b; }
        .btn-del { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; padding: 5px 10px; border-radius: 8px; font-size: 12px; }
        .btn-edit { background: #eff6ff; color: #2563eb; border: 1px solid #dbeafe; padding: 5px 10px; border-radius: 8px; font-size: 12px; margin-left: 5px; }

        .grid-cards { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); 
            gap: 15px; margin-bottom: 20px; 
        }
        .card { 
            background: #fff; border: 2px solid #f1f5f9; border-radius: 20px; 
            padding: 20px; text-align: center; cursor: pointer; border-bottom: 4px solid #cbd5e1;
        }
        .card:hover { border-color: var(--main); transform: translateY(-5px); }
        .card i { font-size: 30px; margin-bottom: 10px; display: block; color: var(--main); }

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .grade-group { background: transparent; border: none; margin-bottom: 30px; }
        .grade-title { 
            background: #fff; color: var(--main); padding: 10px 20px; border-radius: 15px; 
            font-weight: 900; font-size: 1.1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            margin-bottom: 15px; border: 2px solid #e2e8f0; display: inline-block; 
        }
        .lesson-card {
            background: #fff; border-radius: 18px; padding: 15px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid #f1f5f9; border-right: 5px solid var(--sec);
            box-shadow: 0 5px 15px rgba(0,0,0,0.03); cursor: pointer; position: relative; overflow: hidden;
        }
        .lesson-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); border-color: var(--main); }
        .lesson-info { display: flex; align-items: center; gap: 15px; }
        .lesson-icon-box {
            width: 45px; height: 45px; background: #f0fdf4; color: var(--sec);
            border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 20px;
        }
        .lesson-text h4 { margin: 0; font-size: 16px; font-weight: 700; color: #334155; }
        .lesson-text span { font-size: 12px; color: #94a3b8; }
        .lesson-btn {
            background: var(--bg); color: var(--main); width: 35px; height: 35px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 14px;
        }
        #view-bod {
            font-size: 18px; line-height: 1.8; color: #333; background: #fefefe;
            padding: 15px; border-radius: 15px; border: 1px dashed #ccc; margin-top: 15px;
        }

        /* Ø³ØªØ§ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .admin-nav { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .admin-tab { display: none; background: #f9fafb; padding: 20px; border-radius: 20px; border: 1px solid #ddd; }
        .bulk-area { background: #fff; padding: 15px; border-radius: 12px; border: 2px dashed #cbd5e1; margin-top: 15px; }
        .manage-filter-bar { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .manage-filter-btn { background: #fff; border: 1px solid #ccc; padding: 8px 15px; border-radius: 20px; cursor: pointer; white-space: nowrap; }
        .manage-filter-btn.active { background: var(--main); color: white; border-color: var(--main); }

        #q-timer { font-size: 28px; font-weight: 900; color: var(--err); }
        .prog-bg { width:100%; height:8px; background:#eee; border-radius:10px; margin: 15px 0; overflow:hidden; }
        #timer-bar { width:100%; height:100%; background:var(--main); transition:1s linear; }

        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #cbd5e1; border-radius: 12px; font-size: 15px; outline: none; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99999; justify-content: center; align-items: center; padding: 15px; }
        .modal-content { background: white; width: 100%; max-width: 750px; border-radius: 25px; padding: 25px; max-height: 90vh; overflow-y: auto; }

        @media (max-width: 600px) { .grid-cards { grid-template-columns: 1fr 1fr; } }

        #global-loader {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 20000; justify-content: center;
            align-items: center; flex-direction: column;
        }
        .spinner {
            width: 60px; height: 60px; border: 6px solid #f3f3f3;
            border-top: 6px solid var(--main); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loader-text { font-weight: bold; color: var(--main); font-size: 18px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

        #countdown-overlay {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.92);
            z-index: 30000; justify-content: center; align-items: center;
        }
        #countdown-text {
            font-size: 8rem; font-weight: 900; color: #fff;
            text-shadow: 0 0 20px var(--main);
            animation: popEffect 0.9s infinite;
        }
        @keyframes popEffect {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }
        
        /* Ø³ØªØ§ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; }
        th { background: #f8fafc; color: var(--main); font-weight: 800; }
    </style> 
 <style type="text/css" id="dcoder_stylesheet">:root { 
    --main: #4a90e2; 
    --sec: #2ecc71; 
    --vocab: #9b59b6; 
    --video: #e67e22; 
    --err: #e74c3c; 
    --bg: #f4f7f6; 
    --white: #ffffff; 
    --text: #2d3436; 
}

* { 
    box-sizing: border-box; 
    transition: all 0.3s ease; 
    font-family: 'Cairo', sans-serif; 
    -webkit-tap-highlight-color: transparent; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
}

body { 
    background: var(--bg); 
    color: var(--text); 
    margin: 0; 
    padding: 0; 
    min-height: 100vh; 
    direction: rtl;
    overflow-x: hidden; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
}

/* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (SweetAlert) --- */
.swal2-popup { border-radius: 25px !important; font-family: 'Cairo', sans-serif !important; }
.swal2-styled.swal2-confirm { background-color: var(--main) !important; border-radius: 12px !important; }

/* --- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø¯ÙŠØ« --- */
#update-banner {
    display: none; 
    background: #e74c3c; 
    color: white; 
    text-align: center; 
    padding: 12px; 
    font-weight: bold; 
    position: sticky; 
    top: 0; 
    z-index: 10000; 
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
#update-banner a { 
    color: #fff; 
    background: rgba(0,0,0,0.2); 
    padding: 4px 10px; 
    border-radius: 8px; 
    text-decoration: none; 
    margin-right: 10px; 
    border: 1px solid white; 
}

/* --- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --- */
.container { 
    width: 100%; 
    max-width: 950px; 
    background: var(--white); 
    min-height: 100vh;
    padding: 20px; 
    margin: 0 auto; 
    box-shadow: 0 0 20px rgba(0,0,0,0.05); 
}

@media (min-width: 768px) {
    .container {
        border-radius: 30px;
        margin: 20px auto;
        min-height: auto;
        padding: 30px;
    }
}

/* --- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© --- */
.header-brand { text-align: center; margin-bottom: 25px; }
.header-brand img { width: 90px; margin-bottom: 10px; animation: float 3s ease-in-out infinite; }
.header-brand h1 { font-size: 1.8rem; margin: 0; color: var(--main); font-weight: 900; }
.header-brand p { color: #888; margin: 5px 0 0; font-size: 0.9rem; }

@keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0px); }
}

/* --- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ --- */
.social-bar { 
    display: flex; 
    justify-content: center; 
    gap: 20px; 
    margin: 20px 0; 
    border-bottom: 1px solid #eee; 
    padding-bottom: 20px; 
}
.social-bar a { 
    font-size: 28px; 
    text-decoration: none; 
    display: none; /* Ø³ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø±Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§ Ø³ÙƒØ±ÙŠØ¨Øª Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª Ø±ÙˆØ§Ø¨Ø· */
}
.social-bar a:hover { transform: scale(1.2); }

/* --- ØµÙ†Ø¯ÙˆÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ --- */
.student-info-box {
    background: #fff; 
    padding: 20px; 
    border-radius: 20px; 
    border: 1px solid #e2e8f0; 
    margin-bottom: 25px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
}

input, select, textarea { 
    width: 100%; 
    padding: 14px; 
    margin: 10px 0; 
    border: 2px solid #e2e8f0; 
    border-radius: 12px; 
    font-size: 15px; 
    outline: none; 
    background: #f8fafc;
}
input:focus, select:focus, textarea:focus { 
    border-color: var(--main); 
    background: #fff; 
}

/* --- Ø§Ù„Ø£Ø²Ø±Ø§Ø± --- */
.btn { 
    width: 100%; padding: 16px; border-radius: 16px; border: none; 
    font-weight: 700; cursor: pointer; display: flex; 
    align-items: center; justify-content: center; gap: 10px; 
    margin-bottom: 12px; font-size: 16px; color: white;
    user-select: none;
}
.btn:active { transform: scale(0.98); }

.btn-main { background: linear-gradient(135deg, #4a90e2, #2563eb); box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3); }
.btn-sec { background: linear-gradient(135deg, #2ecc71, #219150); box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3); }
.btn-video { background: linear-gradient(135deg, #e67e22, #c2410c); box-shadow: 0 4px 15px rgba(230, 126, 34, 0.3); }
.btn-outline { background: #fff; border: 2px solid #e2e8f0; color: #64748b; }
.btn-del { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; padding: 6px 12px; border-radius: 8px; font-size: 13px; cursor: pointer; }
.btn-edit { background: #eff6ff; color: #2563eb; border: 1px solid #dbeafe; padding: 6px 12px; border-radius: 8px; font-size: 13px; margin-left: 5px; cursor: pointer; }
.btn-admin-login { margin-top:30px; border:none; background:none; color:#cbd5e1; cursor:pointer; font-size: 14px; }

/* --- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Cards) --- */
.grid-cards { 
    display: grid; 
    grid-template-columns: repeat(2, 1fr); /* Ø¹Ù…ÙˆØ¯ÙŠÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    gap: 15px; 
    margin-bottom: 25px; 
}
@media (min-width: 600px) {
    .grid-cards { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
}

.card { 
    background: #fff; 
    border: 2px solid #f1f5f9; 
    border-radius: 24px; 
    padding: 25px 15px; 
    text-align: center; 
    cursor: pointer; 
    border-bottom: 5px solid #cbd5e1;
    position: relative;
    overflow: hidden;
}
.card:active { border-bottom-width: 2px; transform: translateY(3px); }
.card i { font-size: 35px; margin-bottom: 15px; display: block; color: var(--main); }
.card b { display: block; font-size: 1.1rem; color: #334155; }

/* --- ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Quiz) --- */
.quiz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
#q-count { font-weight: bold; color: var(--main); font-size: 1.1rem; }
#q-timer { font-size: 28px; font-weight: 900; color: var(--err); background: #fff; padding: 5px 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }

.prog-bg { width:100%; height:10px; background:#e2e8f0; border-radius:10px; margin: 15px 0; overflow:hidden; }
#timer-bar { width:100%; height:100%; background:var(--main); transition: width 1s linear; }

#q-box { 
    background: #f8fafc; 
    padding: 30px 20px; 
    border-radius: 20px; 
    text-align: center; 
    margin-bottom: 25px; 
    border: 2px solid #e2e8f0; 
}
#q-text { margin: 0; line-height: 1.6; font-size: 1.2rem; color: #334155; }

#q-options { display: grid; grid-template-columns: 1fr; gap: 12px; }
#q-options button { text-align: right; padding-right: 20px; border-width: 2px; font-weight: 600; font-size: 1.1rem; }

#q-rule { 
    background: #fff9db; 
    padding: 20px; 
    border-radius: 16px; 
    margin-top: 20px; 
    border-right: 6px solid #fcc419; 
    line-height: 1.6;
}

/* --- Ø§Ù„Ù…ÙƒØªØ¨Ø© --- */
.grade-group { margin-bottom: 30px; }
.grade-title { 
    background: #fff; color: var(--main); padding: 10px 25px; border-radius: 50px; 
    font-weight: 900; font-size: 1.1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
    margin-bottom: 15px; border: 2px solid #e2e8f0; display: inline-block; 
}
.lesson-card {
    background: #fff; border-radius: 18px; padding: 15px; margin-bottom: 12px;
    display: flex; justify-content: space-between; align-items: center;
    border: 1px solid #f1f5f9; border-right: 5px solid var(--sec);
    box-shadow: 0 2px 10px rgba(0,0,0,0.02); cursor: pointer;
}
.lesson-card:active { transform: scale(0.98); }
.lesson-info { display: flex; align-items: center; gap: 15px; }
.lesson-icon-box {
    width: 45px; height: 45px; background: #f0fdf4; color: var(--sec);
    border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 20px;
}
.lesson-btn {
    background: var(--bg); color: var(--main); width: 35px; height: 35px;
    border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 14px;
}

/* --- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) --- */
.modal { 
    display: none; position: fixed; top: 0; left: 0; 
    width: 100%; height: 100%; background: rgba(0,0,0,0.85); 
    z-index: 99999; justify-content: center; align-items: center; 
    padding: 15px; backdrop-filter: blur(5px);
}
.modal-content { 
    background: white; width: 100%; max-width: 750px; 
    border-radius: 25px; padding: 25px; 
    max-height: 90vh; overflow-y: auto; 
    position: relative;
    box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    animation: slideUp 0.3s ease-out;
}
@keyframes slideUp { from {transform: translateY(50px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

.close-modal {
    position: absolute; left: 20px; top: 15px;
    cursor: pointer; font-size: 35px; color: #94a3b8; line-height: 1;
}
#view-bod {
    font-size: 18px; line-height: 1.8; color: #333; background: #fefefe;
    padding: 15px; border-radius: 15px; border: 1px dashed #ccc; margin-top: 15px;
}
#view-img { width:100%; margin-top:15px; border-radius:15px; }

/* --- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Admin) --- */
.admin-nav { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 25px; }
.admin-nav button { font-size: 13px; padding: 10px 15px; border-radius: 20px; width: auto; margin: 0; flex-grow: 1; }
.admin-tab { display: none; background: #fff; padding: 20px; border-radius: 20px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }

.admin-input-group { background:#f8fafc; padding:15px; border-radius:15px; border:1px solid #e2e8f0; margin-bottom: 15px; }
.bulk-area { background: #f0f9ff; padding: 15px; border-radius: 12px; border: 2px dashed #bae6fd; margin-top: 15px; }

.manage-filter-bar { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 10px; }
.manage-filter-btn { background: #fff; border: 1px solid #ccc; padding: 8px 18px; border-radius: 20px; cursor: pointer; white-space: nowrap; font-weight: bold; }
.manage-filter-btn.active { background: var(--main); color: white; border-color: var(--main); }

#mng-list { max-height:450px; overflow-y:auto; padding-right: 5px; }
/* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #f1f1f1; }
::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

/* --- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ --- */
table.results-table { width: 100%; border-collapse: collapse; min-width: 500px; }
table.results-table th, table.results-table td { padding: 14px; text-align: center; border-bottom: 1px solid #eee; }
table.results-table th { background: #f1f5f9; color: var(--main); font-weight: 800; white-space: nowrap; }

/* --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© --- */
.settings-box { padding:15px; border-radius:15px; border:1px solid #e2e8f0; margin-bottom:15px; }
.settings-basic { background:#f0f7ff; border-color:#4a90e2; }
.settings-social { background:#f0fdf4; border-color:#2ecc71; }
.settings-update { background:#fff7ed; border-color:#e67e22; }
.checkbox-container { display:flex; align-items: center; gap: 10px; margin: 10px 0; cursor: pointer; }
.checkbox-container input { width: 20px; margin: 0; }

/* --- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Loader) --- */
#global-loader {
    display: none; position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255, 255, 255, 0.98);
    z-index: 20000; justify-content: center;
    align-items: center; flex-direction: column;
}
.spinner {
    width: 60px; height: 60px; border: 6px solid #f3f3f3;
    border-top: 6px solid var(--main); border-radius: 50%;
    animation: spin 1s linear infinite; margin-bottom: 20px;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.loader-text { font-weight: bold; color: var(--main); font-size: 18px; animation: pulse 1.5s infinite; }
@keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

/* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ --- */
#countdown-overlay {
    display: none; position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.92);
    z-index: 30000; justify-content: center; align-items: center;
}
#countdown-text {
    font-size: 8rem; font-weight: 900; color: #fff;
    text-shadow: 0 0 30px var(--main);
    animation: popEffect 0.9s infinite;
}
@keyframes popEffect {
    0% { transform: scale(0.5); opacity: 0; }
    50% { transform: scale(1.2); opacity: 1; }
    100% { transform: scale(1); opacity: 0; }
}</style></head> 
 <body> 
  <div id="update-banner"> <span id="update-msg"></span> <a id="update-link" href="#" target="_blank">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†</a> 
  </div> 
  <div id="global-loader"> 
   <div class="spinner"></div> 
   <div class="loader-text">
    Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...
   </div> 
  </div> 
  <div id="countdown-overlay"> 
   <div id="countdown-text"></div> 
  </div> 
  <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio> 
  <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio> 
  <audio id="sound-beep" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio> 
  <audio id="sound-go" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio> 
  <div class="container"> 
   <div id="page-home"> 
    <div class="header-brand"> 
     <img id="disp-logo" src="https://cdn-icons-png.flaticon.com/512/3426/3426653.png"> 
     <h1 id="disp-title">Ù…Ù†ØµØ© Ù„ØºØªÙŠ Ù‡ÙˆÙŠØªÙŠ</h1> 
     <p id="disp-subtitle">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p> 
    </div> 
    <div class="social-bar"> <a id="link-tele" href="#" target="_blank" style="color:#0088cc;"><i class="fab fa-telegram"></i></a> <a id="link-tiktok" href="#" target="_blank"><i class="fab fa-tiktok"></i></a> <a id="link-wa" href="#" target="_blank" style="color:#25d366;"><i class="fab fa-whatsapp"></i></a> <a id="link-face" href="#" target="_blank" style="color:#1877f2;"><i class="fab fa-facebook"></i></a> 
    </div> 
    <div style="background: #fff; padding: 20px; border-radius: 20px; border: 1px solid #e2e8f0; margin-bottom: 20px;"> <label><b>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨:</b></label> 
     <input type="text" id="std-name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ"> <select id="std-grade"> <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ --</option> <optgroup label="Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ"> <option value="4">Ø±Ø§Ø¨Ø¹ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option><option value="5">Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option><option value="6">Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option> </optgroup> <optgroup label="Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ"> <option value="7">Ø£ÙˆÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="8">Ø«Ø§Ù†ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="9">Ø«Ø§Ù„Ø« Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option> </optgroup> </select> 
    </div> 
    <div class="grid-cards"> 
     <div class="card" onclick="openSection('grammar')"> <i class="fas fa-magic"></i><b>Ø±ÙˆØ§Ø¦Ø¹ Ø§Ù„Ù†Ø­Ùˆ</b> 
     </div> 
     <div class="card" onclick="openSection('vocab')"> <i class="fas fa-language"></i><b>Ù‚Ø§Ù…ÙˆØ³Ù†Ø§</b> 
     </div> 
     <div class="card" onclick="openLibrary()"> <i class="fas fa-book-reader"></i><b>Ø§Ù„Ù…ÙƒØªØ¨Ø©</b> 
     </div> 
     <div class="card" onclick="openVideos()"> <i class="fas fa-video"></i><b>Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</b> 
     </div> 
    </div> 
    <center> <button onclick="adminAuth()" style="margin-top:20px; border:none; background:none; color:#cbd5e1; cursor:pointer;">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button> 
    </center> 
   </div> 
   <div id="page-periods" style="display: none;"> 
    <h2 id="period-title" style="text-align: center; color: var(--main);"></h2> 
    <div class="grid-cards"> 
     <div class="card" onclick="startQuiz('Ø´Ø§Ù…Ù„')"> <i class="fas fa-globe"></i><b>Ø´Ø§Ù…Ù„</b> 
     </div> 
     <div class="card" onclick="startQuiz('ØªØ±Ù…1')"> <i class="fas fa-book"></i><b>Ø§Ù„ØªØ±Ù… 1</b> 
     </div> 
     <div class="card" onclick="startQuiz('ØªØ±Ù…2')"> <i class="fas fa-book-open"></i><b>Ø§Ù„ØªØ±Ù… 2</b> 
     </div> 
    </div> 
    <div id="month-grid" class="grid-cards"></div> <button class="btn btn-outline" onclick="goBack('page-home')">Ø¹ÙˆØ¯Ø©</button> 
   </div> 
   <div id="page-quiz" style="display: none;"> 
    <div style="display: flex; justify-content: space-between; align-items: center;"> <button class="btn-outline" style="width:auto; padding:5px 15px;" onclick="location.reload()">Ø®Ø±ÙˆØ¬</button> <span id="q-count" style="font-weight: bold; color: var(--main);"></span> <span id="q-timer">30</span> 
    </div> 
    <div class="prog-bg"> 
     <div id="timer-bar"></div> 
    </div> 
    <div id="q-box" style="background:#f8fafc; padding:25px; border-radius:20px; text-align:center; margin-bottom:20px; border:1px solid #e2e8f0;"> 
     <h3 id="q-text" style="margin:0;"></h3> 
    </div> 
    <div id="q-options" style="display: grid; grid-template-columns: 1fr; gap: 10px;"></div> 
    <div id="q-rule" style="display: none; background: #fff9db; padding: 15px; border-radius: 15px; margin-top: 15px; border-right: 5px solid #fcc419;"> <b>ğŸ’¡ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©:</b> 
     <p id="rule-text" style="margin:5px 0 0;"></p> 
    </div> <button id="btn-next" class="btn btn-main" style="display: none; margin-top: 20px;">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-chevron-left"></i></button> 
   </div> 
   <div id="page-library" style="display: none;"> 
    <h2 style="text-align: center; color: var(--main);">Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ğŸ“š</h2> 
    <div id="lib-content"></div> <button class="btn btn-outline" onclick="goBack('page-home')">Ø¹ÙˆØ¯Ø©</button> 
   </div> 
   <div id="page-videos" style="display: none;"> 
    <h2 style="text-align: center; color: var(--video);">Ø´Ø±ÙˆØ­Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ğŸ¬</h2> 
    <div id="vid-content"></div> <button class="btn btn-outline" onclick="goBack('page-home')">Ø¹ÙˆØ¯Ø©</button> 
   </div> 
   <div id="page-result" style="display: none; text-align: center;"> 
    <h2 id="res-score" style="font-size: 32px; color: var(--main);"></h2> 
    <div id="certificate" style="border: 15px double #d4af37; padding: 40px 20px; background: #fff; margin: 20px 0; border-radius: 10px;"> 
     <h1 style="color:#d4af37; margin:0;">Ø´Ù‡Ø§Ø¯Ø© ØªÙ‚Ø¯ÙŠØ±</h1> 
     <p id="cert-teacher-txt">ÙŠÙ…Ù†Ø­ Ø§Ù„Ø£Ø³ØªØ§Ø° ... Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ù„Ø·Ø§Ù„Ø¨/Ø©:</p> 
     <h2 id="cert-name" style="border-bottom: 2px solid #d4af37; display: inline-block; padding: 0 30px; margin: 10px 0;"></h2> 
     <p>Ù„ØªØ­Ù‚ÙŠÙ‚Ù‡ Ø¯Ø±Ø¬Ø§Øª Ù…ØªÙ…ÙŠØ²Ø© ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.</p> 
    </div> <button class="btn btn-main" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø©</button> <button class="btn btn-outline" onclick="location.reload()">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button> 
   </div> 
   <div id="page-admin" style="display: none;"> 
    <h2 style="text-align: center;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø© âš™ï¸</h2> 
    <div class="admin-nav"> <button class="btn btn-main" onclick="showTab('tab-q')">Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¦Ù„Ø©</button> <button class="btn btn-sec" onclick="showTab('tab-l')">Ø§Ù„Ù…ÙƒØªØ¨Ø©</button> <button class="btn btn-video" onclick="showTab('tab-v')">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</button> <button class="btn btn-outline" onclick="showTab('tab-mng'); loadManageData('all');">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button> <button class="btn btn-outline" onclick="showTab('tab-results'); loadStudentResults();" style="border-color:var(--sec); color:var(--sec);">ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button> <button class="btn btn-outline" onclick="showTab('tab-settings')" style="border-color:#4a90e2; color:#4a90e2;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</button> 
    </div> 
    <div id="tab-q" class="admin-tab" style="display: block;"> 
     <h3>Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø©</h3> 
     <div style="background:#fff; padding:15px; border-radius:15px; border:1px solid #eee;"> <select id="in-q-grade"> <option value="4">Ø§Ù„Ø±Ø§Ø¨Ø¹</option><option value="5">Ø§Ù„Ø®Ø§Ù…Ø³</option><option value="6">Ø§Ù„Ø³Ø§Ø¯Ø³</option> <option value="7">1 Ø¥Ø¹Ø¯</option><option value="8">2 Ø¥Ø¹Ø¯</option><option value="9">3 Ø¥Ø¹Ø¯</option> </select> <select id="in-q-type"><option value="grammar">Ù†Ø­Ùˆ</option><option value="vocab">Ù…ÙØ±Ø¯Ø§Øª</option></select> <select id="in-q-month"> <option value="Ø´Ø§Ù…Ù„">Ø´Ø§Ù…Ù„</option> <option value="Ø£ÙƒØªÙˆØ¨Ø±">Ø£ÙƒØªÙˆØ¨Ø±</option><option value="Ù†ÙˆÙÙ…Ø¨Ø±">Ù†ÙˆÙÙ…Ø¨Ø±</option><option value="Ø¯ÙŠØ³Ù…Ø¨Ø±">Ø¯ÙŠØ³Ù…Ø¨Ø±</option> <option value="ÙØ¨Ø±Ø§ÙŠØ±">ÙØ¨Ø±Ø§ÙŠØ±</option><option value="Ù…Ø§Ø±Ø³">Ù…Ø§Ø±Ø³</option><option value="Ø£Ø¨Ø±ÙŠÙ„">Ø£Ø¨Ø±ÙŠÙ„</option> </select> 
     </div> 
     <div class="bulk-area"> <b>ğŸš€ Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ø¬Ù…Ø¹ (JSON):</b> <textarea id="in-bulk" rows="5" placeholder="[{&quot;q&quot;:&quot;Ø³Ø¤Ø§Ù„1&quot;, &quot;c&quot;:&quot;ØµØ­&quot;, &quot;w&quot;:[&quot;Ø®Ø·Ø£1&quot;,&quot;Ø®Ø·Ø£2&quot;,&quot;Ø®Ø·Ø£3&quot;], &quot;rule&quot;:&quot;Ù‚Ø§Ø¹Ø¯Ø©&quot;}, ...]"></textarea> <button class="btn btn-main" onclick="saveBulk()" style="margin-top:5px;">Ø±ÙØ¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button> 
     </div> 
     <div style="margin-top:15px; border-top:1px solid #ddd; padding-top:10px;"> <b>Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯:</b> 
      <input id="in-q-txt" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„"> 
      <input id="in-q-c" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©"> 
      <input id="in-q-w1" placeholder="Ø®Ø·Ø£ 1"> 
      <input id="in-q-w2" placeholder="Ø®Ø·Ø£ 2"> 
      <input id="in-q-rule" placeholder="Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"> <button class="btn btn-sec" onclick="saveSingleQ()">Ø­ÙØ¸ Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯</button> 
     </div> 
    </div> 
    <div id="tab-l" class="admin-tab"> 
     <h3>Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©</h3> <select id="in-l-grade"><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select> 
     <input id="in-l-tit" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³"> <textarea id="in-l-bod" rows="4" placeholder="Ø§Ù„Ø´Ø±Ø­..."></textarea> 
     <input id="in-l-img" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø£Ùˆ PDF"> <button class="btn btn-sec" onclick="saveLesson()">Ù†Ø´Ø±</button> 
    </div> 
    <div id="tab-v" class="admin-tab"> 
     <h3>Ù†Ø´Ø± ÙÙŠØ¯ÙŠÙˆ</h3> <select id="in-v-grade"><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select> 
     <input id="v-tit" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"> 
     <input id="v-url" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ ØªÙŠÙƒ ØªÙˆÙƒ"> <button class="btn btn-video" onclick="saveVideo()">Ù†Ø´Ø±</button> 
    </div> 
    <div id="tab-mng" class="admin-tab"> 
     <h3>Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3> 
     <div class="manage-filter-bar"> <button class="manage-filter-btn active" onclick="loadManageData('all', this)">Ø§Ù„ÙƒÙ„</button> <button class="manage-filter-btn" onclick="loadManageData('questions', this)">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button> <button class="manage-filter-btn" onclick="loadManageData('lessons', this)">Ø§Ù„Ø¯Ø±ÙˆØ³</button> <button class="manage-filter-btn" onclick="loadManageData('videos', this)">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</button> 
     </div> 
     <div id="mng-list" style="max-height:400px; overflow-y:auto; background:white; padding:10px; border-radius:10px; border:1px solid #ddd;"></div> 
    </div> 
    <div id="tab-results" class="admin-tab"> 
     <h3>Ø³Ø¬Ù„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ğŸ†</h3> <button class="btn btn-del" onclick="clearResults()" style="width:auto; float:left; margin-bottom:10px;">Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button> 
     <div style="overflow-x:auto;"> 
      <table style="width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden;"> 
       <thead> 
        <tr style="background:var(--main); color:#fff;"> 
         <th style="padding:10px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th> 
         <th style="padding:10px;">Ø§Ù„Ø·Ø§Ù„Ø¨</th> 
         <th style="padding:10px;">Ø§Ù„ØµÙ</th> 
         <th style="padding:10px;">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th> 
         <th style="padding:10px;">Ø§Ù„Ø¯Ø±Ø¬Ø©</th> 
        </tr> 
       </thead> 
       <tbody id="results-body"></tbody> 
      </table> 
     </div> 
    </div> 
    <div id="tab-settings" class="admin-tab"> 
     <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø© ğŸ› ï¸</h3> 
     <div style="background:#f0f7ff; padding:15px; border-radius:15px; border:1px solid #4a90e2; margin-bottom:15px;"> <b>ğŸ“ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:</b> 
      <input type="text" id="set-title" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØµØ©"> 
      <input type="text" id="set-subtitle" placeholder="ÙˆØµÙ Ù‚ØµÙŠØ±"> 
      <input type="text" id="set-logo" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±"> 
      <input type="text" id="set-welcome-msg" placeholder="Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨"> 
     </div> 
     <div style="background:#f0fdf4; padding:15px; border-radius:15px; border:1px solid #2ecc71; margin-bottom:15px;"> <b>ğŸ”— Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ:</b> 
      <input type="text" id="set-wa" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨"> 
      <input type="text" id="set-tele" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…"> 
      <input type="text" id="set-face" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ"> 
      <input type="text" id="set-tiktok" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙŠÙƒ ØªÙˆÙƒ"> 
     </div> 
     <div style="background:#fff7ed; padding:15px; border-radius:15px; border:1px solid #e67e22;"> <b>ğŸ“² Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«:</b> 
      <input type="text" id="admin-app-url" placeholder="Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯"> <label style="display:block; margin:10px 0; cursor:pointer;"> <input type="checkbox" id="admin-show-banner"> <b>ØªÙØ¹ÙŠÙ„ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø­Ù…Ø±</b> </label> 
      <input type="text" id="admin-update-msg" placeholder="Ù†Øµ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«"> 
     </div> <button class="btn btn-main" onclick="saveSiteSettings()" style="margin-top:15px;">Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button> 
    </div> <button class="btn btn-outline" onclick="adminLogout()" style="margin-top:20px; border-color:#e74c3c; color:#e74c3c;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†</button> 
   </div> 
  </div> 
  <div id="modal-view" class="modal"> 
   <div class="modal-content"> <span onclick="closeModal()" style="float:left; cursor:pointer; font-size:35px;">Ã—</span> 
    <h2 id="view-tit"></h2> 
    <div id="view-bod" style="white-space: pre-wrap;"></div> 
    <img id="view-img" style="display:none; width:100%; margin-top:15px; border-radius:15px;"> 
   </div> 
  </div> 
  <div id="modal-edit" class="modal"> 
   <div class="modal-content"> <span onclick="document.getElementById('modal-edit').style.display='none'" style="float:left; cursor:pointer; font-size:35px;">Ã—</span> 
    <h3>ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ†Ù‚Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ âœï¸</h3> 
    <p>Ù‚Ù… Ø¨ØªØºÙŠÙŠØ± Ø§Ù„ØµÙ Ø£Ùˆ Ø§Ù„Ø´Ù‡Ø± Ù„Ù†Ù‚Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„/Ø§Ù„Ø¯Ø±Ø³.</p> 
    <input type="hidden" id="edit-id"> 
    <input type="hidden" id="edit-col"> <label>Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</label> <select id="edit-grade"> <option value="4">Ø§Ù„Ø±Ø§Ø¨Ø¹</option><option value="5">Ø§Ù„Ø®Ø§Ù…Ø³</option><option value="6">Ø§Ù„Ø³Ø§Ø¯Ø³</option> <option value="7">1 Ø¥Ø¹Ø¯</option><option value="8">2 Ø¥Ø¹Ø¯</option><option value="9">3 Ø¥Ø¹Ø¯</option> </select> <label>Ø§Ù„Ø´Ù‡Ø± (Ù„Ù„Ø£Ø³Ø¦Ù„Ø©):</label> <select id="edit-month"> <option value="Ø´Ø§Ù…Ù„">Ø´Ø§Ù…Ù„</option> <option value="Ø£ÙƒØªÙˆØ¨Ø±">Ø£ÙƒØªÙˆØ¨Ø±</option><option value="Ù†ÙˆÙÙ…Ø¨Ø±">Ù†ÙˆÙÙ…Ø¨Ø±</option><option value="Ø¯ÙŠØ³Ù…Ø¨Ø±">Ø¯ÙŠØ³Ù…Ø¨Ø±</option> <option value="ÙØ¨Ø±Ø§ÙŠØ±">ÙØ¨Ø±Ø§ÙŠØ±</option><option value="Ù…Ø§Ø±Ø³">Ù…Ø§Ø±Ø³</option><option value="Ø£Ø¨Ø±ÙŠÙ„">Ø£Ø¨Ø±ÙŠÙ„</option> </select> <label>Ø§Ù„Ù†ÙˆØ¹:</label> <select id="edit-type"><option value="grammar">Ù†Ø­Ùˆ</option><option value="vocab">Ù…ÙØ±Ø¯Ø§Øª</option></select> <button class="btn btn-main" onclick="saveEdit()" style="margin-top:15px;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button> 
   </div> 
  </div> 
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, deleteDoc, doc, getDoc, setDoc, writeBatch, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    // --- ØªÙƒÙˆÙŠÙ† Firebase (Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ) ---
    const firebaseConfig = {
      apiKey: "AIzaSyCgpj7MLByWpTVUE2Tg3DQ0pwsUjLhAyEM",
      authDomain: "ahmedead-5185c.firebaseapp.com",
      projectId: "ahmedead-5185c",
      storageBucket: "ahmedead-5185c.firebasestorage.app",
      messagingSenderId: "559908876854",
      appId: "1:559908876854:web:e8e7c151e984dc13219e97"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    window.showLoader = () => document.getElementById('global-loader').style.display = 'flex';
    window.hideLoader = () => document.getElementById('global-loader').style.display = 'none';

    // --- ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ---
    let welcomeMsg = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© Ù„ØºØªÙŠ Ù‡ÙˆÙŠØªÙŠ"; 

    async function loadSiteConfig() {
        showLoader();
        try {
            const snapApp = await getDoc(doc(db, "settings", "app_config"));
            if (snapApp.exists()) {
                const data = snapApp.data();
                if(data.download_url) {
                    document.getElementById('update-link').href = data.download_url;
                    if(document.getElementById('admin-app-url')) document.getElementById('admin-app-url').value = data.download_url;
                }
                if(data.show_banner) {
                    document.getElementById('update-banner').style.display = 'block';
                    document.getElementById('update-msg').innerText = data.update_msg || "ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯!";
                    if(document.getElementById('admin-show-banner')) document.getElementById('admin-show-banner').checked = true;
                    if(document.getElementById('admin-update-msg')) document.getElementById('admin-update-msg').value = data.update_msg || "";
                }
            }

            const snapSite = await getDoc(doc(db, "settings", "site_info"));
            if (snapSite.exists()) {
                const info = snapSite.data();
                if(info.title) {
                    document.title = info.title;
                    document.getElementById('disp-title').innerText = info.title;
                    if(document.getElementById('set-title')) document.getElementById('set-title').value = info.title;
                }
                if(info.subtitle) {
                    document.getElementById('disp-subtitle').innerText = info.subtitle;
                    document.getElementById('cert-teacher-txt').innerText = `ÙŠÙ…Ù†Ø­ ${info.subtitle.split('Ù…Ø¹')[1] || "Ø§Ù„Ø£Ø³ØªØ§Ø°"} Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ù„Ø·Ø§Ù„Ø¨/Ø©:`;
                    if(document.getElementById('set-subtitle')) document.getElementById('set-subtitle').value = info.subtitle;
                }
                if(info.logo) {
                    document.getElementById('disp-logo').src = info.logo;
                    if(document.getElementById('set-logo')) document.getElementById('set-logo').value = info.logo;
                }
                if(info.welcome) {
                    welcomeMsg = info.welcome;
                    if(document.getElementById('set-welcome-msg')) document.getElementById('set-welcome-msg').value = info.welcome;
                }

                 const updateLink = (id, url, inputId) => {
                const el = document.getElementById(id);
                let finalUrl = url;

                // Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ù‡Ùˆ Ø§Ù„Ø­Ù„ Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
                if (url && id === 'link-wa') {
                    // 1. ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ù‚Ù… Ù…Ù† Ø£ÙŠ Ø±Ù…ÙˆØ² ÙˆØ­Ø±ÙˆÙ
                    let cleanNum = url.replace(/\D/g, ''); 
                    
                    // 2. Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ù…ØµØ± (2) Ù„Ùˆ Ø§Ù„Ø±Ù‚Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 01 ÙˆÙ„ÙŠØ³ ÙÙŠÙ‡ ÙƒÙˆØ¯ Ø¯ÙˆÙ„Ø©
                    if (cleanNum.startsWith('01')) cleanNum = '2' + cleanNum;
                    
                    // 3. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ ØµÙŠØºØ© wa.me Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
                    finalUrl = `https://wa.me/${cleanNum}`;
                }

                if(url) { 
                    el.href = finalUrl; 
                    el.style.display = 'inline-block'; 
                    
                    // Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹: Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± ÙŠØ¬Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ ÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ
                    el.onclick = (e) => {
                        e.preventDefault();
                        window.open(finalUrl, '_system');
                    };
                } 
                else { el.style.display = 'none'; }

                if(document.getElementById(inputId)) document.getElementById(inputId).value = url || "";
            };

                updateLink('link-wa', info.wa, 'set-wa');
                updateLink('link-tele', info.tele, 'set-tele');
                updateLink('link-face', info.face, 'set-face');
                updateLink('link-tiktok', info.tiktok, 'set-tiktok');
            } else {
                document.getElementById('disp-title').innerText = "Ù…Ù†ØµØ© Ù„ØºØªÙŠ Ù‡ÙˆÙŠØªÙŠ";
                document.getElementById('disp-subtitle').innerText = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… Ù…Ø¹ Ø£. Ø£Ø­Ù…Ø¯ Ø¹ÙŠØ¯";
            }
        } catch(e) { console.log(e); } finally { hideLoader(); }
    }
    loadSiteConfig();

    window.saveSiteSettings = async () => {
        showLoader();
        try {
            await setDoc(doc(db, "settings", "site_info"), {
                title: document.getElementById('set-title').value,
                subtitle: document.getElementById('set-subtitle').value,
                logo: document.getElementById('set-logo').value,
                welcome: document.getElementById('set-welcome-msg').value,
                wa: document.getElementById('set-wa').value,
                tele: document.getElementById('set-tele').value,
                face: document.getElementById('set-face').value,
                tiktok: document.getElementById('set-tiktok').value
            }, { merge: true });

            await setDoc(doc(db, "settings", "app_config"), {
                download_url: document.getElementById('admin-app-url').value,
                show_banner: document.getElementById('admin-show-banner').checked,
                update_msg: document.getElementById('admin-update-msg').value
            }, { merge: true });

            alert("ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØªØ·Ø¨ÙŠÙ‚Ù‡Ø§!"); location.reload();
        } catch(e) { console.error(e); alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸"); } finally { hideLoader(); }
    };

    window.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            Swal.fire({
                title: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„! ğŸš€',
                text: welcomeMsg,
                imageUrl: document.getElementById('disp-logo').src,
                imageWidth: 80, imageHeight: 80,
                confirmButtonText: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©',
                padding: '2em', backdrop: `rgba(0,0,123,0.4)`
            });
        }, 1500);
    });

    window.alert = function(msg) { Swal.fire({ text: msg, confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹', customClass: { popup: 'swal2-popup' } }); };
    const customConfirm = async (msg) => {
        const result = await Swal.fire({ text: msg, icon: 'warning', showCancelButton: true, confirmButtonText: 'Ù†Ø¹Ù…', cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡', customClass: { popup: 'swal2-popup' } });
        return result.isConfirmed;
    };

    let questions = [], curIdx = 0, score = 0, timer, timeLeft = 30, currentSection = '';
    const months = ["Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„"];
    const gradeNames = { "4": "Ø±Ø§Ø¨Ø¹ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "5": "Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "6": "Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "7": "Ø£ÙˆÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "8": "Ø«Ø§Ù†ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "9": "Ø«Ø§Ù„Ø« Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ" };

    window.runCountdown = (callback) => {
        const overlay = document.getElementById('countdown-overlay');
        const txt = document.getElementById('countdown-text');
        const beepSound = document.getElementById('sound-beep');
        const goSound = document.getElementById('sound-go');

        overlay.style.display = 'flex';
        let count = 3;
        const tick = () => {
            if (count > 0) {
                txt.innerText = count; txt.style.color = "#fff";
                beepSound.currentTime = 0; beepSound.play().catch(e => console.log(e));
                count--; setTimeout(tick, 1000);
            } else {
                txt.innerText = "Ø§Ù†Ø·Ù„Ù‚!"; txt.style.color = "#2ecc71";
                goSound.currentTime = 0; goSound.play().catch(e => console.log(e));
                setTimeout(() => { overlay.style.display = 'none'; callback(); }, 1000);
            }
        };
        tick();
    };

    window.goBack = (id) => { document.querySelectorAll('.container > div').forEach(d => d.style.display = 'none'); document.getElementById(id).style.display = 'block'; };

    window.openSection = (type) => {
        const grade = document.getElementById('std-grade').value;
        const name = document.getElementById('std-name').value;
        if(!name || !grade) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!");
        currentSection = type;
        goBack('page-periods');
        document.getElementById('period-title').innerText = `Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ${type === 'grammar' ? 'Ø§Ù„Ù†Ø­Ùˆ' : 'Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª'}`;
        document.getElementById('month-grid').innerHTML = months.map(m => `<div class="card" onclick="startQuiz('${m}')"><b>${m}</b></div>`).join('');
    };

    window.adminAuth = async () => {
        if (auth.currentUser) { goBack('page-admin'); return; }
        const { value: formValues } = await Swal.fire({
            title: 'Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¢Ù…Ù†',
            html: '<input id="swal-input1" class="swal2-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" type="email">' +
                  '<input id="swal-input2" class="swal2-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password">',
            focusConfirm: false, confirmButtonText: 'Ø¯Ø®ÙˆÙ„', showCancelButton: true, cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
            preConfirm: () => [document.getElementById('swal-input1').value, document.getElementById('swal-input2').value]
        });
        if (formValues) {
            const [email, password] = formValues;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                Swal.fire({ icon: 'success', title: 'ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', timer: 1500, showConfirmButton: false });
                goBack('page-admin');
            } catch (error) { Swal.fire({ icon: 'error', title: 'ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„' }); }
        }
    };

    window.adminLogout = async () => { try { await signOut(auth); location.reload(); } catch(e) { console.error(e); } };
    window.showTab = (id) => { document.querySelectorAll('.admin-tab').forEach(t => t.style.display = 'none'); document.getElementById(id).style.display = 'block'; };

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø¹ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ---
    window.loadManageData = async (type, btn) => {
        if(btn) { document.querySelectorAll('.manage-filter-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
        const list = document.getElementById('mng-list');
        list.innerHTML = '<p style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>';
        let items = [];
        try {
            if(type === 'all' || type === 'questions') {
                const qSnap = await getDocs(collection(db, "questions"));
                qSnap.docs.forEach(d => items.push({id: d.id, ...d.data(), col: 'questions', icon: 'â“', lbl:'Ø³Ø¤Ø§Ù„'}));
            }
            if(type === 'all' || type === 'lessons') {
                const lSnap = await getDocs(collection(db, "lessons"));
                lSnap.docs.forEach(d => items.push({id: d.id, ...d.data(), col: 'lessons', icon: 'ğŸ“š', lbl:'Ø¯Ø±Ø³'}));
            }
            if(type === 'all' || type === 'videos') {
                const vSnap = await getDocs(collection(db, "videos"));
                vSnap.docs.forEach(d => items.push({id: d.id, ...d.data(), col: 'videos', icon: 'ğŸ¬', lbl:'ÙÙŠØ¯ÙŠÙˆ'}));
            }
            list.innerHTML = items.length ? items.map(item => {
                let title = item.q || item.title || "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
                let info = item.grade ? `(${gradeNames[item.grade]})` : "";
                // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Pen)
                return `<div style="display:flex; justify-content:space-between; align-items:center; padding:12px; border-bottom:1px solid #eee; background:#fff; margin-bottom:5px; border-radius:8px;">
                            <div style="flex:1;">
                                <span style="font-size:18px; margin-left:5px;">${item.icon}</span> 
                                <span style="font-weight:bold; font-size:14px; color:#333;">${title.substring(0, 50)}...</span>
                                <div style="font-size:12px; color:#888; margin-right:28px;">${item.lbl} - ${info} ${item.type ? '- ' + item.type : ''}</div>
                            </div>
                            <div>
                                <button class="btn-edit" onclick="openEditModal('${item.id}', '${item.col}', '${item.grade}', '${item.month || ''}', '${item.type || ''}')"><i class="fas fa-pen"></i> ØªØ¹Ø¯ÙŠÙ„</button>
                                <button class="btn-del" onclick="delDoc('${item.col}','${item.id}')"><i class="fas fa-trash"></i> Ø­Ø°Ù</button>
                            </div>
                        </div>`;
            }).join('') : '<p style="text-align:center; color:#888;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰.</p>';
        } catch(e) { console.error(e); list.innerHTML = '<p>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¬Ù„Ø¨</p>'; }
    };

    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ù†Ù‚Ù„ ---
    window.openEditModal = (id, col, g, m, t) => {
        document.getElementById('edit-id').value = id;
        document.getElementById('edit-col').value = col;
        document.getElementById('edit-grade').value = g;
        if(m) document.getElementById('edit-month').value = m;
        if(t) document.getElementById('edit-type').value = t;
        document.getElementById('modal-edit').style.display = 'flex';
    };

    window.saveEdit = async () => {
        const id = document.getElementById('edit-id').value;
        const col = document.getElementById('edit-col').value;
        showLoader();
        try {
            await updateDoc(doc(db, col, id), {
                grade: document.getElementById('edit-grade').value,
                month: document.getElementById('edit-month').value,
                type: document.getElementById('edit-type').value
            });
            alert("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ†Ù‚Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!");
            document.getElementById('modal-edit').style.display = 'none';
            loadManageData('all'); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        } catch(e) { console.error(e); alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„"); } finally { hideLoader(); }
    };

    window.delDoc = async (coll, id) => { 
        if(await customConfirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) { 
            try { await deleteDoc(doc(db, coll, id)); alert("ØªÙ… Ø§Ù„Ø­Ø°Ù."); loadManageData('all'); } catch (e) { alert("Ø®Ø·Ø£! Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª."); }
        } 
    };

    window.startQuiz = async (period) => {
        showLoader();
        try {
            const grade = document.getElementById('std-grade').value;
            let qry;
            if(period === 'Ø´Ø§Ù…Ù„') qry = query(collection(db, "questions"), where("grade", "==", grade), where("type", "==", currentSection));
            else qry = query(collection(db, "questions"), where("grade", "==", grade), where("type", "==", currentSection), where("month", "==", period));
            
            const snap = await getDocs(qry);
            questions = snap.docs.map(d => ({id: d.id, ...d.data()})).sort(() => Math.random() - 0.5);
            
            hideLoader();
            if(!questions.length) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…Ø¶Ø§ÙØ© Ù‡Ù†Ø§.");
            curIdx = 0; score = 0;
            runCountdown(() => { goBack('page-quiz'); showQuestion(); });
        } catch (e) { console.error(e); hideLoader(); alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"); }
    };

    function showQuestion() {
        if(curIdx >= questions.length) return endQuiz();
        clearInterval(timer); timeLeft = 30; updateTimer();
        document.getElementById('btn-next').style.display = 'none';
        document.getElementById('q-rule').style.display = 'none';
        const q = questions[curIdx];
        document.getElementById('q-count').innerText = `Ø³Ø¤Ø§Ù„ ${curIdx+1} / ${questions.length}`;
        document.getElementById('q-text').innerText = q.q;
        let opts = [q.c, ...q.w].sort(() => Math.random() - 0.5);
        document.getElementById('q-options').innerHTML = opts.map(o => `<button class="btn btn-outline" style="text-align:right;" onclick="checkAnswer(this, '${o}')">${o}</button>`).join('');
        timer = setInterval(() => { timeLeft--; updateTimer(); if(timeLeft <= 0) checkAnswer(null, ''); }, 1000);
    }

    window.checkAnswer = (btn, val) => {
        clearInterval(timer);
        const q = questions[curIdx];
        document.querySelectorAll('#q-options button').forEach(b => b.style.pointerEvents = 'none');
        if(val === q.c) {
            score++; document.getElementById('sound-correct').play();
            if(btn) { btn.style.background = "#2ecc71"; btn.style.color = "#fff"; }
        } else {
            document.getElementById('sound-wrong').play();
            if(btn) { btn.style.background = "#e74c3c"; btn.style.color = "#fff"; }
            document.querySelectorAll('#q-options button').forEach(b => { if(b.innerText === q.c) { b.style.background = "#2ecc71"; b.style.color = "#fff"; } });
        }
        if(q.rule) { document.getElementById('rule-text').innerText = q.rule; document.getElementById('q-rule').style.display = 'block'; }
        document.getElementById('btn-next').style.display = 'block';
    };

    document.getElementById('btn-next').onclick = () => { curIdx++; showQuestion(); };

    async function endQuiz() {
        goBack('page-result');
        const percentage = (score / questions.length) * 100;
        document.getElementById('res-score').innerText = `Ø¯Ø±Ø¬ØªÙƒ: ${score} Ù…Ù† ${questions.length}`;
        
        // --- Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ---
        try {
            await addDoc(collection(db, "results"), {
                name: document.getElementById('std-name').value,
                grade: document.getElementById('std-grade').value,
                score: score, total: questions.length,
                date: new Date().toLocaleString('ar-EG'),
                examType: document.getElementById('period-title').innerText
            });
        } catch(e) { console.log("Error saving result", e); }
        // ----------------------------------

        if(percentage >= 70) {
            document.getElementById('certificate').style.display = 'block';
            document.getElementById('cert-name').innerText = document.getElementById('std-name').value;
            confetti({ particleCount: 150, spread: 70 });
        } else document.getElementById('certificate').style.display = 'none';
    }

    // --- Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„Ø£Ø¯Ù…Ù† ---
        window.loadStudentResults = async () => {
        const tbody = document.getElementById('results-body');
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</td></tr>';
        
        try {
            const snap = await getDocs(collection(db, "results"));
            
            if (snap.empty) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</td></tr>';
                return;
            }

            let html = '';
            
            // Ù‡Ø°Ø§ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø®Ø·Ø£ Ù„Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù†Ø§Ù‚Øµ
            const sortedDocs = snap.docs.sort((a, b) => {
                const dateA = a.data().date || ""; 
                const dateB = b.data().date || "";
                return dateB.localeCompare(dateA);
            });

            sortedDocs.forEach(d => {
                const r = d.data();
                // Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© Ø¶Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ©
                const gradeTxt = gradeNames[r.grade] || r.grade || "-";
                const scoreVal = r.score !== undefined ? r.score : 0;
                const totalVal = r.total !== undefined ? r.total : 0;
                
                const color = (totalVal > 0 && (scoreVal / totalVal) >= 0.7) ? '#2ecc71' : '#e74c3c';
                
                html += `<tr style="border-bottom:1px solid #eee; text-align:center;">
                        <td style="padding:10px; font-size:12px; color:#666;">${r.date || "ØºÙŠØ± Ù…Ø³Ø¬Ù„"}</td>
                        <td style="padding:10px; font-weight:bold;">${r.name || "Ù…Ø¬Ù‡ÙˆÙ„"}</td>
                        <td style="padding:10px;">${gradeTxt}</td>
                        <td style="padding:10px;">${r.examType || "Ø§Ø®ØªØ¨Ø§Ø±"}</td>
                        <td style="padding:10px; font-weight:bold; color:${color};">${scoreVal} / ${totalVal}</td>
                    </tr>`;
            });
            
            tbody.innerHTML = html;

        } catch(e) { 
            console.error(e); 
            tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:red;">Ø­Ø¯Ø« Ø®Ø·Ø£: ${e.message}</td></tr>`; 
        }
    };

    window.clearResults = async () => {
        if(await customConfirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ")) {
            showLoader();
            try {
                const snap = await getDocs(collection(db, "results"));
                const batch = writeBatch(db);
                snap.docs.forEach(d => batch.delete(d.ref));
                await batch.commit();
                alert("ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­"); loadStudentResults();
            } catch(e) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£"); } finally { hideLoader(); }
        }
    };

    window.openLibrary = async () => {
        showLoader();
        try {
            goBack('page-library');
            const snap = await getDocs(collection(db, "lessons"));
            const container = document.getElementById('lib-content');
            container.innerHTML = '';
            let grps = {};
            snap.docs.forEach(d => { const l = d.data(); if(!grps[l.grade]) grps[l.grade] = []; grps[l.grade].push({...l, id: d.id}); });
            if (Object.keys(grps).length === 0) container.innerHTML = '<div style="text-align:center; padding:40px; color:#888;">Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
            for(let g in grps) {
                let div = document.createElement('div'); div.className = 'grade-group';
                div.innerHTML = `<div class="grade-title"><i class="fas fa-user-graduate"></i> ${gradeNames[g]}</div>`;
                grps[g].forEach(lesson => {
                    let card = document.createElement('div'); card.className = 'lesson-card';
                    card.innerHTML = `<div class="lesson-info"><div class="lesson-icon-box"><i class="fas fa-book"></i></div><div class="lesson-text"><h4>${lesson.title}</h4><span>Ø§Ø¶ØºØ· Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©</span></div></div><div class="lesson-btn"><i class="fas fa-chevron-left"></i></div>`;
                    card.onclick = () => {
                        document.getElementById('view-tit').innerText = lesson.title;
                        document.getElementById('view-bod').innerText = lesson.body;
                        const imgElem = document.getElementById('view-img');
                        if(lesson.img) { imgElem.src = lesson.img; imgElem.style.display = 'block'; } else { imgElem.style.display = 'none'; }
                        document.getElementById('modal-view').style.display = 'flex';
                    };
                    div.appendChild(card);
                });
                container.appendChild(div);
            }
        } catch(e) { console.error(e); alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø©"); } finally { hideLoader(); }
    };

    window.openVideos = async () => {
        showLoader();
        try {
            goBack('page-videos');
            const snap = await getDocs(collection(db, "videos"));
            document.getElementById('vid-content').innerHTML = snap.docs.map(d => {
                const v = d.data();
                let link = v.url.includes('youtube') ? `<iframe width="100%" height="200" src="https://www.youtube.com/embed/${v.url.split('v=')[1] || v.url.split('/').pop()}" frameborder="0" allowfullscreen style="border-radius:15px;"></iframe>` : `<a href="${v.url}" target="_blank" class="btn btn-video">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</a>`;
                return `<div class="grade-group" style="padding:15px;"><h3 style="margin-top:0;">${v.title} (${gradeNames[v.grade]})</h3>${link}</div>`;
            }).join('');
        } catch(e) { console.error(e); } finally { hideLoader(); }
    };

    window.saveBulk = async () => {
        try {
            const data = JSON.parse(document.getElementById('in-bulk').value);
            const grade = document.getElementById('in-q-grade').value;
            const type = document.getElementById('in-q-type').value;
            const month = document.getElementById('in-q-month').value;
            const batch = writeBatch(db);
            data.forEach(q => { const ref = doc(collection(db, "questions")); batch.set(ref, { ...q, grade, type, month }); });
            await batch.commit(); alert("ØªÙ… Ø§Ù„Ø±ÙØ¹!"); document.getElementById('in-bulk').value = '';
        } catch(e) { alert("Ø®Ø·Ø£! Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø£Ùˆ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©."); }
    };

    window.saveSingleQ = async () => {
        try {
            await addDoc(collection(db, "questions"), {
                grade: document.getElementById('in-q-grade').value, type: document.getElementById('in-q-type').value, month: document.getElementById('in-q-month').value,
                q: document.getElementById('in-q-txt').value, c: document.getElementById('in-q-c').value,
                w: [document.getElementById('in-q-w1').value, document.getElementById('in-q-w2').value, "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©"],
                rule: document.getElementById('in-q-rule').value
            }); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸!");
        } catch (e) { alert("Ø®Ø·Ø£! Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©."); }
    };

    window.saveLesson = async () => {
        try { await addDoc(collection(db, "lessons"), { grade: document.getElementById('in-l-grade').value, title: document.getElementById('in-l-tit').value, body: document.getElementById('in-l-bod').value, img: document.getElementById('in-l-img').value }); alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±!"); } catch (e) { alert("Ø®Ø·Ø£! Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©."); }
    };

    window.saveVideo = async () => {
        try { await addDoc(collection(db, "videos"), { grade: document.getElementById('in-v-grade').value, title: document.getElementById('v-tit').value, url: document.getElementById('v-url').value }); alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±!"); } catch (e) { alert("Ø®Ø·Ø£! Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©."); }
    };

    window.closeModal = () => document.getElementById('modal-view').style.display = 'none';
    function updateTimer() { document.getElementById('timer-bar').style.width = (timeLeft/30)*100 + "%"; document.getElementById('q-timer').innerText = timeLeft; }
</script> 
<script>
    // ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    window.addEventListener('load', function() {
        if (!navigator.onLine) {
            Swal.fire({
                icon: 'error',
                title: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª',
                text: 'Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ù†ØªØ±Ù†Øª Ù„ÙŠØ¹Ù…Ù„. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.',
                confirmButtonText: 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„',
                allowOutsideClick: false
            }).then((result) => {
                if (result.isConfirmed) {
                    location.reload();
                }
            });
        }
    });

    // ÙƒÙˆØ¯ Ø®Ø§Øµ Ù„Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (WebIntoApp Specific)
    document.addEventListener("backbutton", function(e){
        if(document.getElementById('page-home').style.display === 'block'){
            e.preventDefault();
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù‡Ù†Ø§
            navigator.app.exitApp();
        } else {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† ÙÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ Ù‚Ù… Ø¨ØªÙ†ÙÙŠØ° ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
            navigator.app.backHistory();
        }
    }, false);
</script>

 
<script type="text/javascript" id="dcoder_script">// Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø§Øª Firebase Ø§Ù„Ø±Ø³Ù…ÙŠØ©
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where, deleteDoc, doc, getDoc, setDoc, writeBatch, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

// --- 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (Ù„Ø§ ØªØºÙŠØ± Ø´ÙŠØ¦Ø§Ù‹ Ù‡Ù†Ø§) ---
const firebaseConfig = {
    apiKey: "AIzaSyCgpj7MLByWpTVUE2Tg3DQ0pwsUjLhAyEM",
    authDomain: "ahmedead-5185c.firebaseapp.com",
    projectId: "ahmedead-5185c",
    storageBucket: "ahmedead-5185c.firebasestorage.app",
    messagingSenderId: "559908876854",
    appId: "1:559908876854:web:e8e7c151e984dc13219e97"
};

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„Ù…Ù†Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡
let app, db, auth;

try {
    app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    auth = getAuth(app);
    console.log("Firebase initialized successfully");
} catch (e) {
    console.error("Firebase init error:", e);
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
}

// Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
let questions = [], curIdx = 0, score = 0, timer, timeLeft = 30, currentSection = '';
const months = ["Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„"];
const gradeNames = { "4": "Ø±Ø§Ø¨Ø¹ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "5": "Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "6": "Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "7": "Ø£ÙˆÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "8": "Ø«Ø§Ù†ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "9": "Ø«Ø§Ù„Ø« Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ" };

// Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¹Ø±Ø¶
const showLoader = () => document.getElementById('global-loader').style.display = 'flex';
const hideLoader = () => document.getElementById('global-loader').style.display = 'none';

// --- 2. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ ÙÙŠ ÙƒØ§Ø¦Ù† ÙˆØ§Ø­Ø¯ Ù„ØªÙƒÙˆÙ† Ù…ØªØ§Ø­Ø© Ù„Ù…Ù„Ù HTML ---
const appFunctions = {

    // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
    goBack: (id) => {
        document.querySelectorAll('.container > div').forEach(d => d.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        window.scrollTo(0,0);
    },

    // ÙØªØ­ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ù†Ø­Ùˆ / Ù…ÙØ±Ø¯Ø§Øª)
    openSection: (type) => {
        const grade = document.getElementById('std-grade').value;
        const name = document.getElementById('std-name').value;
        if (!name || !grade) return Swal.fire({ icon: 'warning', title: 'ØªÙ†Ø¨ÙŠÙ‡', text: 'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ Ø£ÙˆÙ„Ø§Ù‹!' });
        
        currentSection = type;
        appFunctions.goBack('page-periods');
        document.getElementById('period-title').innerText = `Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ${type === 'grammar' ? 'Ø§Ù„Ù†Ø­Ùˆ' : 'Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª'}`;
        document.getElementById('month-grid').innerHTML = months.map(m => 
            `<div class="card" onclick="window.appFunctions.startQuiz('${m}')"><b>${m}</b></div>`
        ).join('');
    },

    // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
    startQuiz: async (period) => {
        showLoader();
        try {
            const grade = document.getElementById('std-grade').value;
            let qry;
            if (period === 'Ø´Ø§Ù…Ù„') {
                qry = query(collection(db, "questions"), where("grade", "==", grade), where("type", "==", currentSection));
            } else {
                qry = query(collection(db, "questions"), where("grade", "==", grade), where("type", "==", currentSection), where("month", "==", period));
            }

            const snap = await getDocs(qry);
            questions = snap.docs.map(d => ({ id: d.id, ...d.data() })).sort(() => Math.random() - 0.5);

            hideLoader();
            if (!questions.length) return Swal.fire({ icon: 'info', text: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…Ø¶Ø§ÙØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.' });

            curIdx = 0; score = 0;
            runCountdown(() => {
                appFunctions.goBack('page-quiz');
                showQuestion();
            });
        } catch (e) {
            console.error(e);
            hideLoader();
            Swal.fire({ icon: 'error', title: 'Ø®Ø·Ø£', text: 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.' });
        }
    },

    saveSingleQ: async () => {
        try {
            await addDoc(collection(db, "questions"), {
                grade: document.getElementById('in-q-grade').value,
                type: document.getElementById('in-q-type').value,
                month: document.getElementById('in-q-month').value,
                q: document.getElementById('in-q-txt').value,
                c: document.getElementById('in-q-c').value,
                w: [document.getElementById('in-q-w1').value, document.getElementById('in-q-w2').value, "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©"],
                rule: document.getElementById('in-q-rule').value
            });
            Swal.fire('ØªÙ… Ø§Ù„Ø­ÙØ¸!', '', 'success');
            document.getElementById('in-q-txt').value = ''; 
        } catch (e) { alert("Ø®Ø·Ø£! Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©."); }
    },

    saveBulk: async () => {
        try {
            const data = JSON.parse(document.getElementById('in-bulk').value);
            const grade = document.getElementById('in-q-grade').value;
            const type = document.getElementById('in-q-type').value;
            const month = document.getElementById('in-q-month').value;
            const batch = writeBatch(db);
            data.forEach(q => { const ref = doc(collection(db, "questions")); batch.set(ref, { ...q, grade, type, month }); });
            await batch.commit(); 
            Swal.fire('ØªÙ… Ø§Ù„Ø±ÙØ¹!', 'ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            document.getElementById('in-bulk').value = '';
        } catch(e) { Swal.fire('Ø®Ø·Ø£', 'ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ JSON', 'error'); }
    },

    // Ø§Ù„Ù…ÙƒØªØ¨Ø©
    openLibrary: async () => {
        showLoader();
        try {
            appFunctions.goBack('page-library');
            const snap = await getDocs(collection(db, "lessons"));
            const container = document.getElementById('lib-content');
            container.innerHTML = '';
            
            let grps = {};
            snap.docs.forEach(d => { 
                const l = d.data(); 
                if (!grps[l.grade]) grps[l.grade] = []; 
                grps[l.grade].push({ ...l, id: d.id }); 
            });

            if (Object.keys(grps).length === 0) container.innerHTML = '<div style="text-align:center; padding:40px; color:#888;">Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';

            for (let g in grps) {
                let div = document.createElement('div'); 
                div.className = 'grade-group';
                div.innerHTML = `<div class="grade-title"><i class="fas fa-user-graduate"></i> ${gradeNames[g]}</div>`;
                
                grps[g].forEach(lesson => {
                    let card = document.createElement('div'); card.className = 'lesson-card';
                    card.innerHTML = `<div class="lesson-info"><div class="lesson-icon-box"><i class="fas fa-book"></i></div><div class="lesson-text"><h4>${lesson.title}</h4><span>Ø§Ø¶ØºØ· Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©</span></div></div><div class="lesson-btn"><i class="fas fa-chevron-left"></i></div>`;
                    card.onclick = () => {
                        document.getElementById('view-tit').innerText = lesson.title;
                        document.getElementById('view-bod').innerText = lesson.body;
                        const imgElem = document.getElementById('view-img');
                        if (lesson.img) { imgElem.src = lesson.img; imgElem.style.display = 'block'; } else { imgElem.style.display = 'none'; }
                        document.getElementById('modal-view').style.display = 'flex';
                    };
                    div.appendChild(card);
                });
                container.appendChild(div);
            }
        } catch (e) { console.error(e); } finally { hideLoader(); }
    },

    saveLesson: async () => {
        try { await addDoc(collection(db, "lessons"), { grade: document.getElementById('in-l-grade').value, title: document.getElementById('in-l-tit').value, body: document.getElementById('in-l-bod').value, img: document.getElementById('in-l-img').value }); Swal.fire('ØªÙ… Ø§Ù„Ù†Ø´Ø±!', '', 'success'); } catch (e) { alert("Ø®Ø·Ø£! Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©."); }
    },

    // Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
    openVideos: async () => {
        showLoader();
        try {
            appFunctions.goBack('page-videos');
            const snap = await getDocs(collection(db, "videos"));
            document.getElementById('vid-content').innerHTML = snap.docs.map(d => {
                const v = d.data();
                let link = v.url.includes('youtube') || v.url.includes('youtu.be') 
                    ? `<iframe width="100%" height="200" src="https://www.youtube.com/embed/${v.url.split('v=')[1] || v.url.split('/').pop()}" frameborder="0" allowfullscreen style="border-radius:15px;"></iframe>` 
                    : `<a href="${v.url}" target="_blank" class="btn btn-video">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</a>`;
                return `<div class="grade-group" style="padding:15px; background:#fff; border-radius:15px; margin-bottom:15px; border:1px solid #eee;"><h3 style="margin-top:0;">${v.title} (${gradeNames[v.grade]})</h3>${link}</div>`;
            }).join('');
        } catch (e) { console.error(e); } finally { hideLoader(); }
    },

    saveVideo: async () => {
        try { await addDoc(collection(db, "videos"), { grade: document.getElementById('in-v-grade').value, title: document.getElementById('v-tit').value, url: document.getElementById('v-url').value }); Swal.fire('ØªÙ… Ø§Ù„Ù†Ø´Ø±!', '', 'success'); } catch (e) { alert("Ø®Ø·Ø£! Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©."); }
    },

    // --- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ---
    adminAuth: async () => {
        if (auth.currentUser) { appFunctions.goBack('page-admin'); return; }
        const { value: formValues } = await Swal.fire({
            title: 'Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¢Ù…Ù†',
            html: '<input id="swal-input1" class="swal2-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" type="email">' +
                  '<input id="swal-input2" class="swal2-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password">',
            focusConfirm: false, confirmButtonText: 'Ø¯Ø®ÙˆÙ„', showCancelButton: true, cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
            preConfirm: () => [document.getElementById('swal-input1').value, document.getElementById('swal-input2').value]
        });
        if (formValues) {
            const [email, password] = formValues;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                Swal.fire({ icon: 'success', title: 'ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', timer: 1500, showConfirmButton: false });
                appFunctions.goBack('page-admin');
            } catch (error) { Swal.fire({ icon: 'error', title: 'ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„', text: 'ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±' }); }
        }
    },

    adminLogout: async () => { try { await signOut(auth); location.reload(); } catch (e) { console.error(e); } },
    showTab: (id) => { document.querySelectorAll('.admin-tab').forEach(t => t.style.display = 'none'); document.getElementById(id).style.display = 'block'; },

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø¬Ù„Ø¨ ÙˆØ­Ø°Ù ÙˆØªØ¹Ø¯ÙŠÙ„)
    loadManageData: async (type, btn) => {
        if (btn) { document.querySelectorAll('.manage-filter-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
        const list = document.getElementById('mng-list');
        list.innerHTML = '<p style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>';
        let items = [];
        try {
            if (type === 'all' || type === 'questions') {
                const qSnap = await getDocs(collection(db, "questions"));
                qSnap.docs.forEach(d => items.push({ id: d.id, ...d.data(), col: 'questions', icon: 'â“', lbl: 'Ø³Ø¤Ø§Ù„' }));
            }
            if (type === 'all' || type === 'lessons') {
                const lSnap = await getDocs(collection(db, "lessons"));
                lSnap.docs.forEach(d => items.push({ id: d.id, ...d.data(), col: 'lessons', icon: 'ğŸ“š', lbl: 'Ø¯Ø±Ø³' }));
            }
            if (type === 'all' || type === 'videos') {
                const vSnap = await getDocs(collection(db, "videos"));
                vSnap.docs.forEach(d => items.push({ id: d.id, ...d.data(), col: 'videos', icon: 'ğŸ¬', lbl: 'ÙÙŠØ¯ÙŠÙˆ' }));
            }
            list.innerHTML = items.length ? items.map(item => {
                let title = item.q || item.title || "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
                let info = item.grade ? `(${gradeNames[item.grade]})` : "";
                return `<div style="display:flex; justify-content:space-between; align-items:center; padding:12px; border-bottom:1px solid #eee; background:#fff; margin-bottom:5px; border-radius:8px;">
                            <div style="flex:1;">
                                <span style="font-size:18px; margin-left:5px;">${item.icon}</span> 
                                <span style="font-weight:bold; font-size:14px; color:#333;">${title.substring(0, 40)}...</span>
                                <div style="font-size:12px; color:#888; margin-right:28px;">${item.lbl} - ${info} ${item.type ? '- ' + item.type : ''}</div>
                            </div>
                            <div>
                                <button class="btn-edit" onclick="window.appFunctions.openEditModal('${item.id}', '${item.col}', '${item.grade}', '${item.month || ''}', '${item.type || ''}')"><i class="fas fa-pen"></i></button>
                                <button class="btn-del" onclick="window.appFunctions.delDoc('${item.col}','${item.id}')"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>`;
            }).join('') : '<p style="text-align:center; color:#888;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰.</p>';
        } catch (e) { console.error(e); list.innerHTML = '<p>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¬Ù„Ø¨</p>'; }
    },

    delDoc: async (coll, id) => {
        const result = await Swal.fire({ title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ', text: "Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§!", icon: 'warning', showCancelButton: true, confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù', cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡' });
        if (result.isConfirmed) {
            try { await deleteDoc(doc(db, coll, id)); Swal.fire('ØªÙ… Ø§Ù„Ø­Ø°Ù!', '', 'success'); appFunctions.loadManageData('all'); } catch (e) { Swal.fire('Ø®Ø·Ø£', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©', 'error'); }
        }
    },

    openEditModal: (id, col, g, m, t) => {
        document.getElementById('edit-id').value = id;
        document.getElementById('edit-col').value = col;
        document.getElementById('edit-grade').value = g;
        if (m) document.getElementById('edit-month').value = m;
        if (t) document.getElementById('edit-type').value = t;
        document.getElementById('modal-edit').style.display = 'flex';
    },

    saveEdit: async () => {
        const id = document.getElementById('edit-id').value;
        const col = document.getElementById('edit-col').value;
        showLoader();
        try {
            await updateDoc(doc(db, col, id), {
                grade: document.getElementById('edit-grade').value,
                month: document.getElementById('edit-month').value,
                type: document.getElementById('edit-type').value
            });
            Swal.fire('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„!', '', 'success');
            document.getElementById('modal-edit').style.display = 'none';
            appFunctions.loadManageData('all');
        } catch (e) { console.error(e); Swal.fire('Ø®Ø·Ø£', 'Ø­Ø¯Ø«Øª Ù…Ø´ÙƒÙ„Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', 'error'); } finally { hideLoader(); }
    },

    // --- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ---
    loadStudentResults: async () => {
        const tbody = document.getElementById('results-body');
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</td></tr>';
        try {
            const snap = await getDocs(collection(db, "results"));
            let html = '';
            const sortedDocs = snap.docs.sort((a, b) => {
                 // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø³ÙŠØ·)
                 const dateA = new Date(a.data().date);
                 const dateB = new Date(b.data().date);
                 return dateB - dateA; // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
            });
            
            snap.docs.forEach(d => {
                const r = d.data();
                const gradeTxt = gradeNames[r.grade] || r.grade;
                const color = (r.score / r.total) >= 0.7 ? '#2ecc71' : '#e74c3c';
                html += `<tr style="border-bottom:1px solid #eee; text-align:center;">
                        <td style="padding:10px; font-size:12px; color:#666;">${r.date}</td>
                        <td style="padding:10px; font-weight:bold;">${r.name}</td>
                        <td style="padding:10px;">${gradeTxt}</td>
                        <td style="padding:10px;">${r.examType}</td>
                        <td style="padding:10px; font-weight:bold; color:${color};">${r.score} / ${r.total}</td>
                    </tr>`;
            });
            tbody.innerHTML = html || '<tr><td colspan="5" style="text-align:center; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</td></tr>';
        } catch(e) { console.error(e); tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:red;">Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'; }
    },

    clearResults: async () => {
        const res = await Swal.fire({ title: 'ØªØ­Ø°ÙŠØ± Ø´Ø¯ÙŠØ¯!', text: "Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø¯Ø±Ø¬Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„' });
        if(res.isConfirmed) {
            showLoader();
            try {
                const snap = await getDocs(collection(db, "results"));
                const batch = writeBatch(db);
                snap.docs.forEach(d => batch.delete(d.ref));
                await batch.commit();
                Swal.fire('ØªÙ… Ø§Ù„Ù…Ø³Ø­', '', 'success'); appFunctions.loadStudentResults();
            } catch(e) { Swal.fire('Ø®Ø·Ø£', '', 'error'); } finally { hideLoader(); }
        }
    },

    // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ---
    saveSiteSettings: async () => {
        showLoader();
        try {
            // Ù…Ù†Ø·Ù‚ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø°ÙƒÙŠ
            let waInput = document.getElementById('set-wa').value;
            if(waInput && !waInput.startsWith('http')) {
                // Ø¥Ø°Ø§ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø±Ù‚Ø§Ù…Ø§Ù‹ ÙÙ‚Ø·ØŒ Ù†Ø­ÙˆÙ„Ù‡Ø§ Ù„Ø±Ø§Ø¨Ø·
                waInput = `https://wa.me/20${waInput.replace(/^0+/, '')}`; // Ù†ÙØªØ±Ø¶ ÙƒÙˆØ¯ Ù…ØµØ±ØŒ ÙˆÙ†Ø­ÙŠÙ„ Ø§Ù„ØµÙØ± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            }

            await setDoc(doc(db, "settings", "site_info"), {
                title: document.getElementById('set-title').value,
                subtitle: document.getElementById('set-subtitle').value,
                logo: document.getElementById('set-logo').value,
                welcome: document.getElementById('set-welcome-msg').value,
                wa: waInput, // Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¹Ø¯Ù„
                tele: document.getElementById('set-tele').value,
                face: document.getElementById('set-face').value,
                tiktok: document.getElementById('set-tiktok').value
            }, { merge: true });

            await setDoc(doc(db, "settings", "app_config"), {
                download_url: document.getElementById('admin-app-url').value,
                show_banner: document.getElementById('admin-show-banner').checked,
                update_msg: document.getElementById('admin-update-msg').value
            }, { merge: true });

            Swal.fire('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØªØ·Ø¨ÙŠÙ‚Ù‡Ø§!', 'success').then(() => location.reload());
        } catch(e) { console.error(e); Swal.fire('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸', 'error'); } finally { hideLoader(); }
    },
    
    closeModal: () => document.getElementById('modal-view').style.display = 'none'
};

// --- 3. ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù„Ù†Ø§ÙØ°Ø© (Window) ---
// Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„ÙƒÙŠ ØªØ¹Ù…Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ù…Ù„Ù HTML
window.appFunctions = appFunctions;

// --- 4. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Quiz Logic) ---
function runCountdown(callback) {
    const overlay = document.getElementById('countdown-overlay');
    const txt = document.getElementById('countdown-text');
    const beepSound = document.getElementById('sound-beep');
    const goSound = document.getElementById('sound-go');

    overlay.style.display = 'flex';
    let count = 3;
    
    const tick = () => {
        if (count > 0) {
            txt.innerText = count; txt.style.color = "#fff";
            beepSound.currentTime = 0; beepSound.play().catch(e => console.log("Audio play failed", e));
            count--; setTimeout(tick, 1000);
        } else {
            txt.innerText = "Ø§Ù†Ø·Ù„Ù‚!"; txt.style.color = "#2ecc71";
            goSound.currentTime = 0; goSound.play().catch(e => console.log("Audio play failed", e));
            setTimeout(() => { overlay.style.display = 'none'; callback(); }, 1000);
        }
    };
    tick();
}

function showQuestion() {
    if (curIdx >= questions.length) return endQuiz();
    
    clearInterval(timer); 
    timeLeft = 30; 
    updateTimer();
    
    document.getElementById('btn-next').style.display = 'none';
    document.getElementById('q-rule').style.display = 'none';
    
    const q = questions[curIdx];
    document.getElementById('q-count').innerText = `Ø³Ø¤Ø§Ù„ ${curIdx + 1} / ${questions.length}`;
    document.getElementById('q-text').innerText = q.q;
    
    let opts = [q.c, ...q.w].sort(() => Math.random() - 0.5);
    document.getElementById('q-options').innerHTML = opts.map(o => 
        `<button class="btn btn-outline" onclick="checkAnswer(this, '${o}')">${o}</button>`
    ).join('');
    
    timer = setInterval(() => { 
        timeLeft--; 
        updateTimer(); 
        if (timeLeft <= 0) checkAnswer(null, ''); 
    }, 1000);
}

// Ø¬Ø¹Ù„ Ø¯Ø§Ù„Ø© checkAnswer Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù„Ø£Ù†Ù‡Ø§ ØªØ³ØªØ®Ø¯Ù… Ø¯Ø§Ø®Ù„ generated HTML
window.checkAnswer = (btn, val) => {
    clearInterval(timer);
    const q = questions[curIdx];
    document.querySelectorAll('#q-options button').forEach(b => b.style.pointerEvents = 'none');
    
    if (val === q.c) {
        score++; 
        document.getElementById('sound-correct').play().catch(e=>{});
        if (btn) { btn.style.background = "#2ecc71"; btn.style.color = "#fff"; btn.style.borderColor = "#2ecc71"; }
    } else {
        document.getElementById('sound-wrong').play().catch(e=>{});
        if (btn) { btn.style.background = "#e74c3c"; btn.style.color = "#fff"; btn.style.borderColor = "#e74c3c"; }
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
        document.querySelectorAll('#q-options button').forEach(b => { 
            if (b.innerText === q.c) { b.style.background = "#2ecc71"; b.style.color = "#fff"; } 
        });
    }
    
    if (q.rule) { 
        document.getElementById('rule-text').innerText = q.rule; 
        document.getElementById('q-rule').style.display = 'block'; 
    }
    document.getElementById('btn-next').style.display = 'block';
};

document.getElementById('btn-next').onclick = () => { curIdx++; showQuestion(); };

function updateTimer() { 
    const bar = document.getElementById('timer-bar');
    const txt = document.getElementById('q-timer');
    if(bar && txt) {
        bar.style.width = (timeLeft / 30) * 100 + "%"; 
        txt.innerText = timeLeft; 
    }
}

async function endQuiz() {
    appFunctions.goBack('page-result');
    const percentage = (score / questions.length) * 100;
    document.getElementById('res-score').innerText = `Ø¯Ø±Ø¬ØªÙƒ: ${score} Ù…Ù† ${questions.length}`;
    
    try {
        await addDoc(collection(db, "results"), {
            name: document.getElementById('std-name').value,
            grade: document.getElementById('std-grade').value,
            score: score, total: questions.length,
            date: new Date().toLocaleString('ar-EG'),
            examType: document.getElementById('period-title').innerText
        });
    } catch (e) { console.log("Error saving result", e); }

    if (percentage >= 70) {
        document.getElementById('certificate').style.display = 'block';
        document.getElementById('cert-name').innerText = document.getElementById('std-name').value;
        confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
    } else {
        document.getElementById('certificate').style.display = 'none';
    }
}

// --- 5. Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ---
async function loadSiteConfig() {
    showLoader();
    try {
        const snapApp = await getDoc(doc(db, "settings", "app_config"));
        if (snapApp.exists()) {
            const data = snapApp.data();
            if (data.download_url) {
                document.getElementById('update-link').href = data.download_url;
                if (document.getElementById('admin-app-url')) document.getElementById('admin-app-url').value = data.download_url;
            }
            if (data.show_banner) {
                document.getElementById('update-banner').style.display = 'block';
                document.getElementById('update-msg').innerText = data.update_msg || "ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯!";
                if (document.getElementById('admin-show-banner')) document.getElementById('admin-show-banner').checked = true;
                if (document.getElementById('admin-update-msg')) document.getElementById('admin-update-msg').value = data.update_msg || "";
            }
        }

        const snapSite = await getDoc(doc(db, "settings", "site_info"));
        let welcomeMsg = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© Ù„ØºØªÙŠ Ù‡ÙˆÙŠØªÙŠ";
        
        if (snapSite.exists()) {
            const info = snapSite.data();
            if (info.title) {
                document.title = info.title;
                document.getElementById('disp-title').innerText = info.title;
                if (document.getElementById('set-title')) document.getElementById('set-title').value = info.title;
            }
            if (info.subtitle) {
                document.getElementById('disp-subtitle').innerText = info.subtitle;
                // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
                const teacherName = info.subtitle.includes('Ù…Ø¹') ? info.subtitle.split('Ù…Ø¹')[1] : "Ø§Ù„Ø£Ø³ØªØ§Ø°";
                document.getElementById('cert-teacher-txt').innerText = `ÙŠÙ…Ù†Ø­ ${teacherName} Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ù„Ø·Ø§Ù„Ø¨/Ø©:`;
                if (document.getElementById('set-subtitle')) document.getElementById('set-subtitle').value = info.subtitle;
            }
            if (info.logo) {
                document.getElementById('disp-logo').src = info.logo;
                if (document.getElementById('set-logo')) document.getElementById('set-logo').value = info.logo;
            }
            if (info.welcome) {
                welcomeMsg = info.welcome;
                if (document.getElementById('set-welcome-msg')) document.getElementById('set-welcome-msg').value = info.welcome;
            }

            const updateLink = (id, url, inputId) => {
                const el = document.getElementById(id);
                if (url) { el.href = url; el.style.display = 'inline-block'; } 
                else { el.style.display = 'none'; }
                if (document.getElementById(inputId)) document.getElementById(inputId).value = url || "";
            };

            updateLink('link-wa', info.wa, 'set-wa');
            updateLink('link-tele', info.tele, 'set-tele');
            updateLink('link-face', info.face, 'set-face');
            updateLink('link-tiktok', info.tiktok, 'set-tiktok');
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        setTimeout(() => {
            Swal.fire({
                title: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„! ğŸš€',
                text: welcomeMsg,
                imageUrl: document.getElementById('disp-logo').src,
                imageWidth: 80, imageHeight: 80,
                confirmButtonText: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©',
                padding: '2em', backdrop: `rgba(0,0,123,0.4)`
            });
        }, 500);

    } catch (e) { 
        console.error("Config load error", e); 
        // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù„Ø§ Ù†ÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹ ÙŠØ²Ø¹Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙÙ‚Ø· Ù†Ø®ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    } finally { 
        hideLoader(); 
    }
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
document.addEventListener('DOMContentLoaded', loadSiteConfig);</script></body></html>

